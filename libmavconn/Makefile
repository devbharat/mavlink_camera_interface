## NOT AUTOGENERATED BY CMAKE ##
## @author: Bharat Tak        ## 

ROOT_DIR ?= .
OUT ?= ../out
OUT_DIR := ${OUT}/lib

CC := g++
SYS := $(shell $(CC) -dumpmachine)

ifneq (, $(findstring linux, $(SYS)))
# Linux
	tg_so = ${OUT_DIR}/libmavconn.so
else ifneq (, $(findstring cygwin, $(SYS)))
# Cygwin
	tg_so = ${OUT_DIR}/libmavconn.dll
else
#	exit 1
endif
CFLAGS := -g -std=c++11
override INCLUDES += -I${ROOT_DIR}/include
override INCLUDES += -I${ROOT_DIR}/include/mavlink/include

lib_boost:= -lboost_system

sources_so :=
sources_so += ${ROOT_DIR}/src/interface.cpp
sources_so += ${ROOT_DIR}/src/mavlink_helpers.cpp
sources_so += ${ROOT_DIR}/src/serial.cpp
sources_so += ${ROOT_DIR}/src/tcp.cpp
sources_so += ${ROOT_DIR}/src/udp.cpp
OBJ_DIR := .obj
OBJECTS := $(addprefix $(OBJ_DIR)/, $(notdir $(sources_so:.cpp=.o)))

.PHONY: clean

all: ${OUT_DIR} $(OBJ_DIR) ${tg_so}

objs: $(OBJ_DIR) $(OBJECTS)

${OUT_DIR}:
	mkdir -p ${OUT_DIR}

${tg_so}: $(OBJECTS)
	${CC} $^ --share -o $@ ${lib_boost}

$(OBJ_DIR)/%.o : **/%.cpp
	$(CC) $(CFLAGS) -fPIC -g $(INCLUDES) -o $@ -c $<

$(OBJ_DIR):
	mkdir -p $(OBJ_DIR)

clean:
	rm -rf ${tg_so} $(OBJ_DIR)
